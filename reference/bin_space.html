<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="A function to assign fossil occurrences (or localities) to spatial
bins/samples using a hexagonal equal-area grid."><title>Assign fossil occurrences to spatial bins — bin_space • palaeoverse</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Assign fossil occurrences to spatial bins — bin_space"><meta property="og:description" content="A function to assign fossil occurrences (or localities) to spatial
bins/samples using a hexagonal equal-area grid."><meta property="og:image" content="https://palaeoverse.palaeoverse.org/logo.png"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">palaeoverse</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.1.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/structure-and-standards.html">Contributing to palaeoverse: structure and standards</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/palaeoverse-community/palaeoverse/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Assign fossil occurrences to spatial bins</h1>
      <small class="dont-index">Source: <a href="https://github.com/palaeoverse-community/palaeoverse/blob/HEAD/R/bin_space.R" class="external-link"><code>R/bin_space.R</code></a></small>
      <div class="d-none name"><code>bin_space.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>A function to assign fossil occurrences (or localities) to spatial
bins/samples using a hexagonal equal-area grid.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">bin_space</span><span class="op">(</span></span>
<span>  <span class="va">occdf</span>,</span>
<span>  lng <span class="op">=</span> <span class="st">"lng"</span>,</span>
<span>  lat <span class="op">=</span> <span class="st">"lat"</span>,</span>
<span>  spacing <span class="op">=</span> <span class="fl">100</span>,</span>
<span>  sub_grid <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  return <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  plot <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>occdf</dt>
<dd><p><code>dataframe</code>. A dataframe of the fossil occurrences (or
localities) you wish to bin. This dataframe should contain the decimal
degree coordinates of your occurrences, and they should be of
class <code>numeric</code>.</p></dd>


<dt>lng</dt>
<dd><p><code>character</code>. The name of the column you wish to be treated
as the input longitude (e.g. "lng" or "p_lng").</p></dd>


<dt>lat</dt>
<dd><p><code>character</code>. The name of the column you wish to be treated
as the input latitude (e.g. "lat" or "p_lat").</p></dd>


<dt>spacing</dt>
<dd><p><code>numeric</code>. The desired spacing between the center of
adjacent cells. This value should be provided in kilometres.</p></dd>


<dt>sub_grid</dt>
<dd><p><code>numeric</code>. For an optional sub-grid, the desired
spacing between the center of adjacent cells in the sub-grid.
This value should be provided in kilometres.
See details for information on sub-grid usage.</p></dd>


<dt>return</dt>
<dd><p><code>logical</code>. Should the equal-area grid information and
polygons be returned?</p></dd>


<dt>plot</dt>
<dd><p><code>logical</code>. Should the occupied cells of the equal-area grid
be plotted?</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>If the <code>return</code> argument is set to <code>FALSE</code>, a dataframe is
returned of the original input <code>occdf</code> with cell information. If <code>return</code> is
set to <code>TRUE</code>, a list is returned with both the input <code>occdf</code> and grid
information and polygons.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>This function assigns fossil occurrence data into
equal-area grid cells using discrete hexagonal grids via the
<code><a href="https://obrl-soil.github.io/h3jsr/reference/h3jsr-package.html" class="external-link">h3jsr</a></code> package. This package relies on
<a href="https://h3geo.org/docs/" class="external-link">Uber's H3</a> library, a geospatial indexing system
that partitions the world into hexagonal cells. In H3, 16 different
resolutions are available
(<a href="https://h3geo.org/docs/core-library/restable/" class="external-link">see here</a>). In the
implementation of the <code>bin_space()</code> function, the resolution is defined by
the user-input <code>spacing</code> which represents the distance between the centroid
of adjacent cells. Using this distance, the function identifies which
resolution is most similar to the input <code>spacing</code>, and uses this resolution.</p>
<p>Additional functionality allows the user to simultaneously assign occurrence
data to equal-area grid cells of a finer-scale grid (i.e. a ‘sub-grid’)
within the primary grid via the <code>sub_grid</code> argument. This might be desirable
for users to evaluate the differences in the amount of area occupied by
occurrences within their primary grid cells. This functionality also allows
the user to easily rarefy across sub-grid cells within primary cells to
further standardise spatial sampling (see example for basic implementation).</p>
<p>Note: prior to implementation, coordinate reference system (CRS) for input
data is defined as EPSG:4326 (World Geodetic System
1984). The user should transform their data accordingly if this is
not appropriate. If you are unfamiliar with working with geographic data,
we highly recommend checking out <a href="https://geocompr.robinlovelace.net/index.html" class="external-link">Geocomputation with R</a>.</p>
    </div>
    <div class="section level2">
    <h2 id="developer-s-">Developer(s)<a class="anchor" aria-label="anchor" href="#developer-s-"></a></h2>
    

<p>Lewis A. Jones</p>
    </div>
    <div class="section level2">
    <h2 id="reviewer-s-">Reviewer(s)<a class="anchor" aria-label="anchor" href="#reviewer-s-"></a></h2>
    

<p>Bethany Allen &amp; Kilian Eichenseer</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># Get internal data</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"reefs"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Reduce data for plotting</span></span></span>
<span class="r-in"><span><span class="va">occdf</span> <span class="op">&lt;-</span> <span class="va">reefs</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">250</span>, <span class="op">]</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Bin data using a hexagonal equal-area grid</span></span></span>
<span class="r-in"><span><span class="va">ex1</span> <span class="op">&lt;-</span> <span class="fu">bin_space</span><span class="op">(</span>occdf <span class="op">=</span> <span class="va">occdf</span>, spacing <span class="op">=</span> <span class="fl">500</span>, plot <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Average spacing between adjacent cells in the primary grid was set to 725.17 km. </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> H3 resolution: 1</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Bin data using a hexagonal equal-area grid and sub-grid</span></span></span>
<span class="r-in"><span><span class="va">ex2</span> <span class="op">&lt;-</span> <span class="fu">bin_space</span><span class="op">(</span>occdf <span class="op">=</span> <span class="va">occdf</span>, spacing <span class="op">=</span> <span class="fl">1000</span>, sub_grid <span class="op">=</span> <span class="fl">250</span>, plot <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Average spacing between adjacent cells in the primary grid was set to 725.17 km. </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> H3 resolution: 1</span>
<span class="r-plt img"><img src="bin_space-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># EXAMPLE: rarefy</span></span></span>
<span class="r-in"><span><span class="co"># Load data</span></span></span>
<span class="r-in"><span><span class="va">occdf</span> <span class="op">&lt;-</span> <span class="va">tetrapods</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">250</span>, <span class="op">]</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Assign to spatial bin</span></span></span>
<span class="r-in"><span><span class="va">occdf</span> <span class="op">&lt;-</span> <span class="fu">bin_space</span><span class="op">(</span>occdf <span class="op">=</span> <span class="va">occdf</span>, spacing <span class="op">=</span> <span class="fl">1000</span>, sub_grid <span class="op">=</span> <span class="fl">250</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Average spacing between adjacent cells in the primary grid was set to 725.17 km. </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> H3 resolution: 1</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Get unique bins</span></span></span>
<span class="r-in"><span><span class="va">bins</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">occdf</span><span class="op">$</span><span class="va">cell_ID</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># n reps</span></span></span>
<span class="r-in"><span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">10</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Rarefy data across sub-grid grid cells</span></span></span>
<span class="r-in"><span><span class="co"># Returns a list with each element a bin with respective mean genus richness</span></span></span>
<span class="r-in"><span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">bins</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="co"># subset occdf for respective grid cell</span></span></span>
<span class="r-in"><span>  <span class="va">tmp</span> <span class="op">&lt;-</span> <span class="va">occdf</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">occdf</span><span class="op">$</span><span class="va">cell_ID</span> <span class="op">==</span> <span class="va">x</span><span class="op">)</span>, <span class="op">]</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co"># Which sub-grid cells are there within this bin?</span></span></span>
<span class="r-in"><span>  <span class="va">sub_bin</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">tmp</span><span class="op">$</span><span class="va">cell_ID_sub</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co"># Sample 1 sub-grid cell n times</span></span></span>
<span class="r-in"><span>  <span class="va">s</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="va">sub_bin</span>, size <span class="op">=</span> <span class="va">n</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co"># Count the number of unique genera within each sub_grid cell for each rep</span></span></span>
<span class="r-in"><span>  <span class="va">counts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">s</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>    <span class="co"># Number of unique genera within each sample</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">tmp</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">tmp</span><span class="op">$</span><span class="va">cell_ID_sub</span> <span class="op">==</span> <span class="va">i</span><span class="op">)</span>, <span class="op">]</span><span class="op">$</span><span class="va">genus</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">}</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co"># Mean richness across subsamples</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">counts</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span><span class="op">)</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by <a href="https://www.lewisajones.com" class="external-link">Lewis A. Jones</a>, <a href="https://williamgearty.com" class="external-link">William Gearty</a>, <a href="https://bsse.ethz.ch/cevo/the-group/people/person-detail.html?persid=295484" class="external-link">Bethany J. Allen</a>, <a href="https://keichenseer.netlify.app" class="external-link">Kilian Eichenseer</a>, <a href="https://www.ucl.ac.uk/earth-sciences/people/research-staff/dr-chris-dean" class="external-link">Christopher D. Dean</a>, <a href="https://www.researchgate.net/profile/Joseph-Flannery-Sutherland" class="external-link">Joseph T. Flannery-Sutherland</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer></div>

  

  

  </body></html>

